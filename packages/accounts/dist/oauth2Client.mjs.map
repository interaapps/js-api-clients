{"version":3,"file":"oauth2Client.mjs","sources":["../oauth2Client.ts"],"sourcesContent":["import { BaseClient } from '@interaapps/base-client';\nexport * from './exceptions'\nimport * as exceptions from \"./exceptions\";\nimport {OAuth2TokenExchange} from \"./types/responses\";\nimport {AccountsClient} from \"./index\";\n\nexport class InteraAppsOAuth2URLBuilder {\n    private scopes: string[] = []\n    private redirectUri = ''\n    private state = ''\n    private responseType = 'code'\n\n    constructor(private clientId: string, private baseURL: string = 'https://accounts.interaapps.de') {\n    }\n\n    setScopes(scopes: string[]) {\n        this.scopes = scopes;\n        return this;\n    }\n    getScopes() {\n        return this.scopes;\n    }\n    setResponseType(responseType: 'token' | 'code') {\n        this.responseType = responseType;\n        return this;\n    }\n    getResponseType() {\n        return this.responseType;\n    }\n    setRedirectUri(redirectUri: string) {\n        this.redirectUri = redirectUri;\n        return this;\n    }\n    getRedirectUri() {\n        return this.redirectUri;\n    }\n    setState(state: string) {\n        this.state = state;\n        return this;\n    }\n    getState() {\n        return this.state;\n    }\n    getClientId() {\n        return this.clientId;\n    }\n\n    build() {\n        const urlParams = new URLSearchParams();\n        urlParams.append('client_id', this.clientId);\n        urlParams.append('response_type', this.responseType);\n        urlParams.append('scope', this.scopes.join(' '));\n\n        if (this.redirectUri) urlParams.append('redirect_uri', this.redirectUri);\n        if (this.state) urlParams.append('state', this.state);\n\n        return `${this.baseURL}/auth/oauth2?${urlParams.toString()}`;\n    }\n}\n\nexport class InteraAppsOAuth2Client extends BaseClient {\n    constructor(private clientId: string, private clientSecret: string|undefined, private scopes: string[] =[], private baseURL: string = 'https://accounts.interaapps.de') {\n        super(`${baseURL}/api/v2`);\n        // @ts-ignore\n        this.registeredExceptions = exceptions\n    }\n\n\n    checkScopes(scopes: string[]) {\n        for (const scope of this.scopes) {\n            if (!scopes.includes(scope)) return false;\n        }\n        return false;\n    }\n\n    setScopes(scopes: string[]) {\n        this.scopes = scopes;\n        return this;\n    }\n\n    getScopes() {\n        return this.scopes;\n    }\n\n    async exchangeToken(code: string) {\n        return await this.post('/authorization/oauth2/access_token', {\n            client_id: this.clientId,\n            client_secret: this.clientSecret,\n            code,\n        }) as OAuth2TokenExchange;\n    }\n\n    async exchangeTokenAndGetClient(code: string) {\n        return new AccountsClient((await this.exchangeToken(code)).access_token, this.baseURL)\n    }\n\n    urlBuilder() {\n        return new InteraAppsOAuth2URLBuilder(this.clientId, this.baseURL)\n    }\n}"],"names":[],"mappings":"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"}